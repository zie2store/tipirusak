<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div id="documents"></div>

  <script>
    // Slugify title for URL use
    function slugify(title) {
      return title.trim().replace(/\s+/g, '-').replace(/[^\w\-]/g, '');
    }

    // Load and render the CSV
    fetch('https://raw.githubusercontent.com/zie2store/tipirusak/main/public/scrbd.csv')
      .then(response => response.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            const data = results.data;
            const container = document.getElementById('documents');

            data.forEach(doc => {
              const url = `https://tipirusak.vercel.app?document=${doc.ID}&title=${slugify(doc.Title)}`;

              const html = `
                <h1>${doc.Title}</h1>
                <p>
                  This document is entitled <strong>${doc.Title}</strong> and is uploaded by Scribd Download Team.
                  It contains <strong>${doc.Pages}</strong> pages. This document with ID <strong>${doc.ID}</strong>
                  has been downloaded <strong>${doc.Views}</strong> times. The information we can get from
                  <strong>${doc.Title}</strong> includes <em>${doc.Summary}</em>.
                </p>
                <p><a href="${url}">${url}</a></p>
                <hr/>
              `;

              container.insertAdjacentHTML('beforeend', html);
            });
          }
        });
      })
      .catch(err => {
        console.error('Failed to load CSV:', err);
        document.getElementById('documents').innerHTML = `<p>Error loading documents.</p>`;
      });
  </script>
</body>
</html>
